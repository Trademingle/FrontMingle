{"ast":null,"code":"import _regeneratorRuntime from\"/Users/nandupokhrel/Desktop/BookTrades/trademingle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/nandupokhrel/Desktop/BookTrades/trademingle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/nandupokhrel/Desktop/BookTrades/trademingle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _assertThisInitialized from\"/Users/nandupokhrel/Desktop/BookTrades/trademingle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _classCallCheck from\"/Users/nandupokhrel/Desktop/BookTrades/trademingle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/nandupokhrel/Desktop/BookTrades/trademingle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/nandupokhrel/Desktop/BookTrades/trademingle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/nandupokhrel/Desktop/BookTrades/trademingle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _slicedToArray from\"/Users/nandupokhrel/Desktop/BookTrades/trademingle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{Component,useState}from'react';import{withRouter}from'react-router-dom';import{signin}from'../Firebase/auth';import Popup from'reactjs-popup';import{withStyles}from'@material-ui/core/styles';import SignUpPage from'../SignUp/index.js';import*as ROUTES from'../../constants/routes';import Button from'@material-ui/core/Button';import{compose}from'recompose';import{withFirebase}from'../Firebase';import styles from'./login.module.css';import CloseOutlinedIcon from'@material-ui/icons/CloseOutlined';// import SignUpWithEmail from \"../SignUp/SignUpWithEmail/SUemail\";\nimport glogo from\"../SignUp/icons/google-icon.svg\";// import elogo from '../SignUp/icons/email1.svg';\nimport alogo from\"../SignUp/icons/apple.svg\";import api from'../api/api';import{purple}from'@material-ui/core/colors';import Firebase from'../Firebase/firebase';import swal from'sweetalert';import LoadingView from'../ResuableComponents/loadingView';var contentStyle2={width:'702px',height:'680px',background:'#FFFFFF',borderRadius:'16px'};var SignIn=function SignIn(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),open1=_useState4[0],setOpen1=_useState4[1];var signInCallback=function signInCallback(val){setLoading(false);if(val['usertype']==='Contractor'){window.location.href='/contractorexplore';}else if(val['usertype']==='Client'){window.location.href='/homeownerexplore';}else{swal({title:\"Login Error!\",text:\"Login error! Please make sure you have signed up!\",icon:\"error\",button:\"Try Again\"});}};var onSignIn=function onSignIn(){setLoading(true);Firebase.auth.currentUser.getIdToken(/* forceRefresh */true).then(function(idToken){// Send token to your backend via HTTPS\n// ...\n// informationState['id_token'] = idToken;\napi.signIn({'id_token':idToken},signInCallback);}).catch(function(error){// Handle error\n// setStateCode(9);\nsetLoading(false);console.log(error);});};if(loading){return/*#__PURE__*/React.createElement(LoadingView,null);}return/*#__PURE__*/React.createElement(Popup,{open:props.open,modal:true,contentStyle:contentStyle2},/*#__PURE__*/React.createElement(\"box\",{className:styles.box},/*#__PURE__*/React.createElement(CloseOutlinedIcon,{style:{height:40,width:40},className:styles.cross,onClick:function onClick(){return props.setOpen(false);}}),/*#__PURE__*/React.createElement(\"h1\",{className:styles.header},\"Log in\"),/*#__PURE__*/React.createElement(\"p\",{className:styles.para},\"Whether you're a contractor, homeowner or homebuilder, log in here!\"),/*#__PURE__*/React.createElement(\"box\",{className:styles.rectangle},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(SignInGoogle,{signIn:onSignIn})),/*#__PURE__*/React.createElement(\"button\",{className:styles.apple,onClick:function onClick(){return swal({title:\"Feature Unavailable!\",text:\"Please sign up with google or create an account!\",icon:\"error\",button:\"Go back!\"});}},/*#__PURE__*/React.createElement(\"img\",{src:alogo,className:styles.logo,alt:'apple'}),/*#__PURE__*/React.createElement(\"p\",{ClassName:styles.signupapple,style:{marginTop:'20px'}},\"Log in with Apple\")),/*#__PURE__*/React.createElement(\"div\",{className:styles.linesdiv},/*#__PURE__*/React.createElement(\"hr\",{className:styles.line1}),/*#__PURE__*/React.createElement(\"p\",{className:styles.or},\"OR\"),/*#__PURE__*/React.createElement(\"hr\",{className:styles.line1})),/*#__PURE__*/React.createElement(Login,{setLoading:setLoading,setOpen1:setOpen1}))),/*#__PURE__*/React.createElement(SignUpPage,{setOpen:setOpen1,open:open1}));};var SignInGoogleBase=/*#__PURE__*/function(_Component){_inherits(SignInGoogleBase,_Component);var _super=_createSuper(SignInGoogleBase);function SignInGoogleBase(props){var _this;_classCallCheck(this,SignInGoogleBase);_this=_super.call(this,props);_this.onSubmit=function(event){_this.props.firebase.doSignInWithGoogle().then(function(socialAuthUser){// debugger;\n// this.props.firebase\n//   .user(socialAuthUser.user.uid)\n//   .set({\n//     username: socialAuthUser.user.displayName,\n//     email: socialAuthUser.user.email,\n//     roles: {},\n//   });\n// debugger;\n_this.props.signIn();}).then(function(){_this.setState({error:null});_this.props.history.push(ROUTES.LANDING);}).catch(function(error){_this.setState({error:error});});event.preventDefault();};_this.state={error:null};return _this;}_createClass(SignInGoogleBase,[{key:\"render\",value:function render(){var error=this.state.error;return/*#__PURE__*/React.createElement(\"form\",{onSubmit:this.onSubmit},/*#__PURE__*/React.createElement(\"button\",{className:styles.apple},/*#__PURE__*/React.createElement(\"img\",{src:glogo,className:styles.logo,alt:'google'}),/*#__PURE__*/React.createElement(\"p\",{ClassName:styles.signupapple,style:{marginTop:'20px'}},\"Log in with Google\")),error&&/*#__PURE__*/React.createElement(\"p\",null,error.message));}}]);return SignInGoogleBase;}(Component);var SignInGoogle=compose(withRouter,withFirebase)(SignInGoogleBase);var Login=/*#__PURE__*/function(_Component2){_inherits(Login,_Component2);var _super2=_createSuper(Login);function Login(){var _this2;_classCallCheck(this,Login);_this2=_super2.call(this);_this2.state={error:null,email:'',password:''};_this2.handleChange=_this2.handleChange.bind(_assertThisInitialized(_this2));_this2.handleSubmit=_this2.handleSubmit.bind(_assertThisInitialized(_this2));_this2.loginClicked=_this2.loginClicked.bind(_assertThisInitialized(_this2));return _this2;}_createClass(Login,[{key:\"signInCallback\",value:function signInCallback(val){// console.log(val);\nif(val['usertype']==='Contractor'){window.location.href='/contractorexplore';}else if(val['usertype']==='Client'){window.location.href='/homeownerexplore';}else{swal({title:\"Login Error!\",text:\"Incorrect username or password!\",icon:\"error\",button:\"Try Again\"});}}},{key:\"handleChange\",value:function handleChange(event){this.setState(_defineProperty({},event.target.name,event.target.value));}},{key:\"loginClicked\",value:function loginClicked(event){var _this3=this;this.props.setLoading(true);var callBack=this.signInCallback;if(this.state.email&&this.state.password){Firebase.auth.signInWithEmailAndPassword(this.state.email,this.state.password).then(function(userCredential){userCredential.user.getIdToken(/* forceRefresh */true).then(function(idToken){// Signed in\napi.signIn({'id_token':idToken},callBack);this.props.setLoading(false);});}).catch(function(error){var errorCode=error.code;var errorMessage=error.message;//Still have to sign in with the django backend\nvar info={\"username\":_this3.state.email,\"password\":_this3.state.password};api.signIn(info,_this3.signInCallback);_this3.props.setLoading(false);// ...\n});}}},{key:\"handleSubmit\",value:function(){var _handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();this.setState({error:''});_context.prev=2;_context.next=5;return signin(this.state.email,this.state.password);case 5:_context.next=9;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](2);case 9:case\"end\":return _context.stop();}}},_callee,this,[[2,7]]);}));function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}return handleSubmit;}()},{key:\"render\",value:function render(){var _this4=this;return/*#__PURE__*/React.createElement(\"div\",{className:styles.loginContainer},/*#__PURE__*/React.createElement(\"form\",{autoComplete:\"off\",onSubmit:this.handleSubmit},/*#__PURE__*/React.createElement(\"h3\",{className:styles.password},\"Email\"),/*#__PURE__*/React.createElement(\"div\",{className:styles.rectangle1},/*#__PURE__*/React.createElement(\"input\",{className:styles.input1,placeholder:\"Enter your email address\",name:\"email\",type:\"email\",onChange:this.handleChange,value:this.state.email})),/*#__PURE__*/React.createElement(\"h3\",{className:styles.password},\"Password\"),/*#__PURE__*/React.createElement(\"div\",{className:styles.rectangle1},/*#__PURE__*/React.createElement(\"input\",{className:styles.input1,placeholder:\"Password\",name:\"password\",onChange:this.handleChange,value:this.state.password,type:\"password\"})),/*#__PURE__*/React.createElement(\"div\",{className:styles.loginbuttondiv},this.state.error?/*#__PURE__*/React.createElement(\"p\",{className:\"text-danger\"},this.state.error):null,/*#__PURE__*/React.createElement(LoginButton,{type:\"submit\",className:styles.loginbutton,onClick:this.loginClicked},/*#__PURE__*/React.createElement(\"p\",{className:styles.login},\"Log in \"))),/*#__PURE__*/React.createElement(\"div\",{className:styles.textdiv},/*#__PURE__*/React.createElement(\"p\",{className:styles.text2},\"Don't have an account?\"),/*#__PURE__*/React.createElement(\"p\",{className:styles.signup,onClick:function onClick(){return _this4.props.setOpen1(true);}},\" Sign up\"))));}}]);return Login;}(Component);var LoginButton=withStyles(function(theme){return{root:{color:theme.palette.getContrastText(purple[500]),borderRadius:44,backgroundColor:'#2B64D2','&:hover':{backgroundColor:'#003ba0'}}};})(Button);export default SignIn;","map":{"version":3,"sources":["/Users/nandupokhrel/Desktop/BookTrades/trademingle/src/components/Login/index.js"],"names":["React","Component","useState","withRouter","signin","Popup","withStyles","SignUpPage","ROUTES","Button","compose","withFirebase","styles","CloseOutlinedIcon","api","purple","Firebase","swal","LoadingView","contentStyle2","width","height","background","borderRadius","SignIn","props","loading","setLoading","open1","setOpen1","signInCallback","val","window","location","href","title","text","icon","button","onSignIn","auth","currentUser","getIdToken","then","idToken","signIn","catch","error","console","log","open","box","cross","setOpen","header","para","rectangle","apple","alogo","logo","signupapple","marginTop","linesdiv","line1","or","SignInGoogleBase","onSubmit","event","firebase","doSignInWithGoogle","socialAuthUser","setState","history","push","LANDING","preventDefault","state","glogo","message","SignInGoogle","Login","email","password","handleChange","bind","handleSubmit","loginClicked","target","name","value","callBack","signInWithEmailAndPassword","userCredential","user","errorCode","code","errorMessage","info","loginContainer","rectangle1","input1","loginbuttondiv","loginbutton","login","textdiv","text2","signup","LoginButton","theme","root","color","palette","getContrastText","backgroundColor"],"mappings":"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","sourcesContent":["import React, { Component, useState } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport {signin} from '../Firebase/auth';\nimport Popup from 'reactjs-popup';\nimport { withStyles } from '@material-ui/core/styles';\nimport SignUpPage from '../SignUp/index.js';\nimport * as ROUTES from '../../constants/routes';\nimport Button from '@material-ui/core/Button';\nimport { compose } from 'recompose';\nimport { withFirebase } from '../Firebase';\nimport styles from './login.module.css';\nimport CloseOutlinedIcon from '@material-ui/icons/CloseOutlined';\n// import SignUpWithEmail from \"../SignUp/SignUpWithEmail/SUemail\";\nimport glogo from '../SignUp/icons/google-icon.svg';\n// import elogo from '../SignUp/icons/email1.svg';\nimport alogo from '../SignUp/icons/apple.svg';\nimport api  from '../api/api';\nimport { purple } from '@material-ui/core/colors'; \nimport Firebase from '../Firebase/firebase';\nimport swal from 'sweetalert';\nimport LoadingView from '../ResuableComponents/loadingView';\n\nconst contentStyle2 = {\n  width: '702px',\n  height: '680px',\n  background: '#FFFFFF',\n  borderRadius: '16px', \n};\n\nconst SignIn = (props) => {\n  const [loading, setLoading] = useState(false);\n  const [open1, setOpen1] = useState(false);\n  const signInCallback= (val)=>{\n    setLoading(false)\n    if (val['usertype'] === 'Contractor'){\n      window.location.href='/contractorexplore'\n    }\n    else if (val['usertype'] === 'Client'){\n      window.location.href='/homeownerexplore'\n    }\n    else{\n      swal({\n        title: \"Login Error!\",\n        text: \"Login error! Please make sure you have signed up!\",\n        icon: \"error\",\n        button: \"Try Again\",\n      });\n    }\n  }\n  const onSignIn= ()=>{\n    setLoading(true)\n    Firebase.auth.currentUser.getIdToken(/* forceRefresh */ true).then(function(idToken) {\n      // Send token to your backend via HTTPS\n      // ...\n      // informationState['id_token'] = idToken;\n      api.signIn({'id_token':idToken},signInCallback);\n    }).catch(function(error) {\n      // Handle error\n      // setStateCode(9);\n      setLoading(false)\n      console.log(error)\n    }\n    );\n  }\n  if (loading) {\n    return <LoadingView/>;\n  }\n  return(\n    <Popup open={props.open} modal contentStyle={contentStyle2}>\n    <box className={styles.box}>\n      <CloseOutlinedIcon style={{ height: 40, width: 40 }} className={styles.cross} onClick={()=>props.setOpen(false)}/>\n      <h1 className={styles.header}>Log in</h1>\n      <p className={styles.para}>Whether you're a contractor, homeowner or homebuilder, log in here!</p>\n      <box className={styles.rectangle}>\n        <div>\n          <SignInGoogle signIn={onSignIn}/>\n        </div>\n        <button\n          className={styles.apple}\n          onClick={()=>\n            swal({\n              title: \"Feature Unavailable!\",\n              text: \"Please sign up with google or create an account!\",\n              icon: \"error\",\n              button: \"Go back!\",\n            })}>\n            <img src={alogo} className={styles.logo}alt={'apple'} />\n            <p ClassName={styles.signupapple} style={{marginTop:'20px'}}>Log in with Apple</p>\n        </button>\n        <div className={styles.linesdiv}>\n          <hr className={styles.line1}></hr>\n          <p className={styles.or}>OR</p>\n          <hr className={styles.line1}></hr>\n        </div>\n        <Login setLoading={setLoading} setOpen1={setOpen1}/>\n      </box>\n    </box>\n    <SignUpPage setOpen={setOpen1} open={open1}/>\n    </Popup>\n  );\n}\nclass SignInGoogleBase extends Component {\n  constructor(props) {\n    super(props);\n \n    this.state = { error: null };\n  }\n \n  onSubmit = event => {\n    this.props.firebase\n      .doSignInWithGoogle()\n      .then(socialAuthUser => {\n        // debugger;\n        // this.props.firebase\n        //   .user(socialAuthUser.user.uid)\n        //   .set({\n        //     username: socialAuthUser.user.displayName,\n        //     email: socialAuthUser.user.email,\n        //     roles: {},\n        //   });\n        // debugger;\n        this.props.signIn();\n      })\n      .then(() => {\n        this.setState({ error: null });\n        this.props.history.push(ROUTES.LANDING);\n      })\n      .catch(error => {\n        this.setState({ error });\n      });\n \n    event.preventDefault();\n  };\n \n  render() {\n    const { error } = this.state;\n \n    return (\n      <form onSubmit={this.onSubmit}>\n        <button\n          className={styles.apple}>\n            <img src={glogo} className={styles.logo} alt={'google'}/>\n              <p ClassName={styles.signupapple} style={{marginTop:'20px'}} >Log in with Google</p>\n        </button>\n \n        {error && <p>{error.message}</p>}\n      </form>\n    );\n  }\n}\nconst SignInGoogle = compose(\n  withRouter,\n  withFirebase,\n)(SignInGoogleBase);\n\nclass Login extends Component {\n\n  constructor() {\n    super();\n    this.state = {\n      error: null,\n      email: '',\n      password: '',\n    };\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.loginClicked = this.loginClicked.bind(this);\n  }\n\n  signInCallback(val){\n    // console.log(val);\n    if (val['usertype'] === 'Contractor'){\n      window.location.href='/contractorexplore'\n    }\n    else if (val['usertype'] === 'Client'){\n      window.location.href='/homeownerexplore'\n    }\n    else{\n      swal({\n        title: \"Login Error!\",\n        text: \"Incorrect username or password!\",\n        icon: \"error\",\n        button: \"Try Again\",\n      });\n    }\n  }\n  handleChange(event) {\n    this.setState({\n      [event.target.name]: event.target.value\n    });\n  }\n  loginClicked(event){\n    this.props.setLoading(true)\n    const callBack = this.signInCallback\n    if (this.state.email && this.state.password){\n      Firebase.auth.signInWithEmailAndPassword(this.state.email, this.state.password)\n      .then((userCredential) => {\n        userCredential.user.getIdToken(/* forceRefresh */ true).then(function(idToken) {\n          // Signed in\n          api.signIn({'id_token':idToken},callBack)\n            this.props.setLoading(false)\n        })\n        \n      })\n      .catch((error) => {\n        var errorCode = error.code;\n        var errorMessage = error.message;\n        //Still have to sign in with the django backend\n        const info = {\n          \"username\": this.state.email,\n          \"password\": this.state.password\n        }\n        api.signIn(info,this.signInCallback)\n        this.props.setLoading(false)\n        // ...\n      });\n      \n    }\n  }\n\n  async handleSubmit(event) {\n    event.preventDefault();\n    this.setState({ error: '' });\n    try {\n      await signin(this.state.email, this.state.password);\n    } catch (error) {\n      // this.setState({ error: error.message });\n    }\n  }\n  render() {\n    return (\n      <div className={styles.loginContainer}>\n        <form autoComplete=\"off\" onSubmit={this.handleSubmit}>         \n          <h3 className={styles.password}>Email</h3>\n          <div className={styles.rectangle1}>\n            <input className={styles.input1} placeholder=\"Enter your email address\" name=\"email\" type=\"email\" onChange={this.handleChange} value={this.state.email}></input>\n          </div>\n          <h3 className={styles.password}>Password</h3>\n          <div className={styles.rectangle1}>\n            <input className={styles.input1} placeholder=\"Password\" name=\"password\" onChange={this.handleChange} value={this.state.password} type=\"password\"></input>\n          </div>\n          <div className={styles.loginbuttondiv}>\n            {this.state.error ? <p className=\"text-danger\">{this.state.error}</p> : null}\n            <LoginButton type=\"submit\" className={styles.loginbutton} onClick={this.loginClicked}>\n              <p className={styles.login}>Log in </p>\n            </LoginButton>\n          </div>\n          <div className={styles.textdiv}>\n            <p className={styles.text2}>Don't have an account?</p> \n            <p className={styles.signup} onClick={()=>this.props.setOpen1(true)}> Sign up</p>\n          </div>\n        </form>\n      </div>\n    )\n  }\n}\n\nconst LoginButton = withStyles((theme) => ({\n  root: {\n    color: theme.palette.getContrastText(purple[500]),\n    borderRadius:44,\n    backgroundColor: '#2B64D2',\n    '&:hover': {\n      backgroundColor: '#003ba0',\n    },\n  },\n}))(Button);\n\nexport default SignIn;"]},"metadata":{},"sourceType":"module"}